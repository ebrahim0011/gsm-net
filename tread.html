<!DOCTYPE html><html lang="ar" dir="rtl"><head>    <meta charset="UTF-8">    <meta name="viewport" content="width=device-width, initial-scale=1.0">    <title>صفحة تداول Binance - API الحقيقي</title>    <style>        * {            margin: 0;            padding: 0;            box-sizing: border-box;        }                body {            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;            background: linear-gradient(135deg, #1e1e2e 0%, #181829 100%);            color: #e5e5e5;            min-height: 100vh;        }                .header {            background: #232337;            padding: 1rem 2rem;            display: flex;            justify-content: space-between;            align-items: center;            border-bottom: 1px solid #373757;            position: relative;            overflow: hidden;        }                .header::before {            content: '';            position: absolute;            top: 0;            left: 0;            right: 0;            height: 2px;            background: linear-gradient(90deg, #f0b90b, #10b981, #ef4444, #f0b90b);            background-size: 200% 100%;            animation: headerGlow 3s linear infinite;        }                @keyframes headerGlow {            0% { background-position: -200% 0; }            100% { background-position: 200% 0; }        }                .logo {            color: #f0b90b;            font-size: 1.5rem;            font-weight: bold;            text-shadow: 0 0 10px rgba(240, 185, 11, 0.5);        }                .api-status {            display: flex;            align-items: center;            gap: 0.5rem;        }                .status-dot {            width: 10px;            height: 10px;            border-radius: 50%;            background: #10b981;            animation: pulse 2s infinite;            box-shadow: 0 0 10px rgba(16, 185, 129, 0.6);        }                @keyframes pulse {            0% { transform: scale(1); opacity: 1; }            50% { transform: scale(1.2); opacity: 0.7; }            100% { transform: scale(1); opacity: 1; }        }                .status-dot.disconnected {            background: #ef4444;            box-shadow: 0 0 10px rgba(239, 68, 68, 0.6);        }                .server-time {            font-size: 0.9rem;            color: #9ca3af;            margin-left: 1rem;        }                .container {            max-width: 1400px;            margin: 0 auto;            padding: 2rem;            display: grid;            grid-template-columns: 1fr 350px;            gap: 2rem;        }                .main-trading {            display: grid;            grid-template-rows: auto auto 1fr auto;            gap: 1.5rem;        }                .market-overview {            background: linear-gradient(135deg, #2a2a3a, #232337);            padding: 1.5rem;            border-radius: 12px;            box-shadow: 0 8px 32px rgba(0,0,0,0.3);            border: 1px solid #373757;        }                .market-stats {            display: grid;            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));            gap: 1rem;            margin-bottom: 1rem;        }                .stat-item {            text-align: center;            padding: 0.5rem;            border-radius: 8px;            background: rgba(240, 185, 11, 0.1);        }                .stat-label {            font-size: 0.8rem;            color: #9ca3af;            margin-bottom: 0.25rem;        }                .stat-value {            font-size: 1rem;            font-weight: bold;            color: #e5e5e5;        }                .trading-pair {            background: linear-gradient(135deg, #2a2a3a, #232337);            padding: 1.5rem;            border-radius: 12px;            box-shadow: 0 8px 32px rgba(0,0,0,0.3);            border: 1px solid #373757;            position: relative;            overflow: hidden;        }                .trading-pair::before {            content: '';            position: absolute;            top: 0;            left: -100%;            width: 100%;            height: 2px;            background: linear-gradient(90deg, transparent, #f0b90b, transparent);            animation: shimmer 3s ease-in-out infinite;        }                @keyframes shimmer {            0% { left: -100%; }            100% { left: 100%; }        }                .pair-selector {            display: flex;            gap: 0.5rem;            margin-bottom: 1rem;            flex-wrap: wrap;        }                .pair-button {            padding: 0.5rem 1rem;            border: 1px solid #4b5563;            border-radius: 6px;            background: #374151;            color: #e5e5e5;            cursor: pointer;            transition: all 0.3s ease;            font-size: 0.9rem;        }                .pair-button.active {            background: #f0b90b;            color: #000;            border-color: #f0b90b;            transform: scale(1.05);        }                .pair-info {            display: flex;            justify-content: space-between;            align-items: center;            margin-bottom: 1rem;        }                .pair-name {            font-size: 1.8rem;            font-weight: bold;            color: #f0b90b;            text-shadow: 0 0 15px rgba(240, 185, 11, 0.3);        }                .pair-price {            font-size: 2.2rem;            font-weight: bold;            color: #10b981;            text-shadow: 0 0 15px rgba(16, 185, 129, 0.3);            transition: all 0.3s ease;        }                .price-change {            font-size: 1.1rem;            font-weight: bold;        }                .price-change.positive {            color: #10b981;        }                .price-change.negative {            color: #ef4444;        }                .chart-container {            background: linear-gradient(135deg, #2a2a3a, #232337);            padding: 1.5rem;            border-radius: 12px;            height: 400px;            position: relative;            overflow: hidden;            border: 1px solid #373757;        }                .chart-controls {            display: flex;            gap: 0.5rem;            margin-bottom: 1rem;            flex-wrap: wrap;        }                .interval-button {            padding: 0.4rem 0.8rem;            border: 1px solid #4b5563;            border-radius: 4px;            background: #374151;            color: #e5e5e5;            cursor: pointer;            transition: all 0.3s ease;            font-size: 0.8rem;        }                .interval-button.active {            background: #10b981;            border-color: #10b981;            color: #fff;        }                .chart-canvas {            width: 100%;            height: 320px;            background: rgba(0,0,0,0.2);            border-radius: 8px;            position: relative;            overflow: auto;        }                .trading-form {            background: linear-gradient(135deg, #2a2a3a, #232337);            padding: 1.5rem;            border-radius: 12px;            border: 1px solid #373757;            box-shadow: 0 8px 32px rgba(0,0,0,0.3);        }                .form-tabs {            display: flex;            margin-bottom: 1.5rem;            border-radius: 8px;            overflow: hidden;            background: #1a1a2e;            box-shadow: inset 0 2px 4px rgba(0,0,0,0.3);        }                .tab-button {            flex: 1;            padding: 0.75rem;            border: none;            background: #1a1a2e;            color: #9ca3af;            cursor: pointer;            transition: all 0.3s ease;            font-weight: 500;        }                .tab-button.active {            background: linear-gradient(135deg, #f0b90b, #f59e0b);            color: #000;            transform: translateY(-2px);            box-shadow: 0 4px 15px rgba(240, 185, 11, 0.4);        }                .order-types {            display: flex;            gap: 0.5rem;            margin-bottom: 1rem;        }                .order-type-btn {            flex: 1;            padding: 0.5rem;            border: 1px solid #4b5563;            border-radius: 6px;            background: #374151;            color: #e5e5e5;            cursor: pointer;            transition: all 0.3s ease;            font-size: 0.9rem;        }                .order-type-btn.active {            background: #6366f1;            border-color: #6366f1;            color: #fff;        }                .form-group {            margin-bottom: 1rem;        }                .form-label {            display: block;            margin-bottom: 0.5rem;            color: #d1d5db;            font-weight: 500;            font-size: 0.9rem;        }                .form-input {            width: 100%;            padding: 0.75rem;            border: 1px solid #4b5563;            border-radius: 8px;            background: #374151;            color: #e5e5e5;            font-size: 1rem;            transition: all 0.3s ease;        }                .form-input:focus {            outline: none;            border-color: #f0b90b;            box-shadow: 0 0 0 3px rgba(240, 185, 11, 0.2);            background: #4b5563;        }                .percentage-buttons {            display: flex;            gap: 0.5rem;            margin-top: 0.5rem;        }                .percentage-btn {            flex: 1;            padding: 0.4rem;            border: 1px solid #4b5563;            border-radius: 4px;            background: #374151;            color: #e5e5e5;            cursor: pointer;            transition: all 0.3s ease;            font-size: 0.8rem;        }                .percentage-btn:hover {            background: #4b5563;            transform: translateY(-1px);        }                .order-button {            width: 100%;            padding: 1rem;            border: none;            border-radius: 8px;            font-size: 1rem;            font-weight: bold;            cursor: pointer;            transition: all 0.3s ease;            margin-top: 1rem;            text-transform: uppercase;            letter-spacing: 0.5px;        }                .buy-button {            background: linear-gradient(135deg, #10b981, #059669);            color: white;            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);        }                .sell-button {            background: linear-gradient(135deg, #ef4444, #dc2626);            color: white;            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);        }                .order-button:hover {            transform: translateY(-3px);            box-shadow: 0 8px 25px rgba(0,0,0,0.4);        }                .order-button:active {            transform: translateY(-1px);        }                .sidebar {            display: flex;            flex-direction: column;            gap: 1.5rem;        }                .account-info,        .order-history,        .market-trades,        .order-book {            background: linear-gradient(135deg, #2a2a3a, #232337);            padding: 1.5rem;            border-radius: 12px;            border: 1px solid #373757;            box-shadow: 0 8px 32px rgba(0,0,0,0.3);        }                .section-title {            font-size: 1.2rem;            font-weight: bold;            margin-bottom: 1rem;            color: #f0b90b;            display: flex;            align-items: center;            gap: 0.5rem;        }                .section-title::before {            content: '';            width: 4px;            height: 20px;            background: linear-gradient(135deg, #f0b90b, #f59e0b);            border-radius: 2px;        }                .balance-item {            display: flex;            justify-content: space-between;            align-items: center;            padding: 0.75rem;            margin-bottom: 0.5rem;            background: rgba(240, 185, 11, 0.05);            border-radius: 6px;            border: 1px solid rgba(240, 185, 11, 0.1);            transition: all 0.3s ease;        }                .balance-item:hover {            background: rgba(240, 185, 11, 0.1);            transform: translateX(-5px);        }                .currency {            color: #f0b90b;            font-weight: bold;        }                .amount {            font-weight: bold;            color: #e5e5e5;        }                .trade-item {            display: flex;            justify-content: space-between;            align-items: center;            padding: 0.5rem;            border-bottom: 1px solid #374151;            font-size: 0.9rem;        }                .trade-item:last-child {            border-bottom: none;        }                .trade-price {            font-weight: bold;        }                .trade-buy { color: #10b981; }        .trade-sell { color: #ef4444; }                .order-book {            height: 400px;            overflow-y: auto;        }                .order-book-header {            display: grid;            grid-template-columns: 1fr 1fr 1fr;            gap: 1rem;            padding: 0.5rem 0;            border-bottom: 1px solid #374151;            margin-bottom: 0.5rem;            font-size: 0.8rem;            color: #9ca3af;            font-weight: bold;        }                .order-book-item {            display: grid;            grid-template-columns: 1fr 1fr 1fr;            gap: 1rem;            padding: 0.3rem 0;            font-size: 0.85rem;            border-radius: 4px;            transition: all 0.2s ease;            cursor: pointer;        }                .order-book-item:hover {            background: rgba(240, 185, 11, 0.1);        }                .order-book-asks .order-book-item {            color: #ef4444;        }                .order-book-bids .order-book-item {            color: #10b981;        }                .loading {            display: flex;            align-items: center;            justify-content: center;            padding: 2rem;            color: #9ca3af;        }                .loading::before {            content: '';            width: 20px;            height: 20px;            border: 2px solid #4b5563;            border-top: 2px solid #f0b90b;            border-radius: 50%;            animation: spin 1s linear infinite;            margin-left: 0.5rem;        }                @keyframes spin {            0% { transform: rotate(0deg); }            100% { transform: rotate(360deg); }        }                .error {            background: rgba(239, 68, 68, 0.1);            color: #ef4444;            padding: 1rem;            border-radius: 6px;            border: 1px solid rgba(239, 68, 68, 0.3);            margin-bottom: 1rem;        }                .success {            background: rgba(16, 185, 129, 0.1);            color: #10b981;            padding: 1rem;            border-radius: 6px;            border: 1px solid rgba(16, 185, 129, 0.3);            margin-bottom: 1rem;        }                .price-flash {            animation: priceFlash 0.5s ease-in-out;        }                @keyframes priceFlash {            0% { background: rgba(240, 185, 11, 0.3); }            100% { background: transparent; }        }                @media (max-width: 768px) {            .container {                grid-template-columns: 1fr;                padding: 1rem;            }                        .header {                padding: 1rem;                flex-wrap: wrap;                gap: 1rem;            }                        .market-stats {                grid-template-columns: repeat(2, 1fr);            }                        .pair-selector {                justify-content: center;            }        }    </style></head><body>    <header class="header">        <div class="logo">🪙 Binance Trading Pro</div>        <div style="display: flex; align-items: center; gap: 1rem;">            <div class="server-time" id="serverTime">تحميل...</div>            <div class="api-status">                <div class="status-dot" id="statusDot"></div>                <span id="statusText">جاري الاتصال...</span>            </div>        </div>    </header>        <div class="container">        <div class="main-trading">            <div class="market-overview">                <div class="market-stats">                    <div class="stat-item">                        <div class="stat-label">24h حجم التداول</div>                        <div class="stat-value" id="volume24h">-</div>                    </div>                    <div class="stat-item">                        <div class="stat-label">أعلى سعر 24h</div>                        <div class="stat-value" id="high24h">-</div>                    </div>                    <div class="stat-item">                        <div class="stat-label">أقل سعر 24h</div>                        <div class="stat-value" id="low24h">-</div>                    </div>                    <div class="stat-item">                        <div class="stat-label">عدد الصفقات</div>                        <div class="stat-value" id="count24h">-</div>                    </div>                    <div class="stat-item">                        <div class="stat-label">متوسط السعر</div>                        <div class="stat-value" id="avgPrice">-</div>                    </div>                    <div class="stat-item">                        <div class="stat-label">سعر الإغلاق السابق</div>                        <div class="stat-value" id="prevClosePrice">-</div>                    </div>                </div>            </div>                        <div class="trading-pair">                <div class="pair-selector">                    <button class="pair-button active" onclick="changePair('BTCUSDT')">BTC/USDT</button>                    <button class="pair-button" onclick="changePair('ETHUSDT')">ETH/USDT</button>                    <button class="pair-button" onclick="changePair('BNBUSDT')">BNB/USDT</button>                    <button class="pair-button" onclick="changePair('ADAUSDT')">ADA/USDT</button>                    <button class="pair-button" onclick="changePair('SOLUSDT')">SOL/USDT</button>                    <button class="pair-button" onclick="changePair('DOGEUSDT')">DOGE/USDT</button>                    <button class="pair-button" onclick="changePair('XRPUSDT')">XRP/USDT</button>                    <button class="pair-button" onclick="changePair('DOTUSDT')">DOT/USDT</button>                </div>                                <div class="pair-info">                    <div>                        <div class="pair-name" id="pairName">BTC/USDT</div>                        <div class="pair-price" id="pairPrice">$0.00</div>                    </div>                    <div class="price-change" id="priceChange">0.00%</div>                </div>            </div>                        <div class="chart-container">                <div class="chart-controls">                    <button class="interval-button active" onclick="changeInterval('1m')">1م</button>                    <button class="interval-button" onclick="changeInterval('3m')">3م</button>                    <button class="interval-button" onclick="changeInterval('5m')">5م</button>                    <button class="interval-button" onclick="changeInterval('15m')">15م</button>                    <button class="interval-button" onclick="changeInterval('30m')">30م</button>                    <button class="interval-button" onclick="changeInterval('1h')">1س</button>                    <button class="interval-button" onclick="changeInterval('4h')">4س</button>                    <button class="interval-button" onclick="changeInterval('1d')">1ي</button>                </div>                <div class="chart-canvas" id="chartCanvas">                    <div class="loading">جاري تحميل الرسم البياني...</div>                </div>            </div>                        <div class="trading-form">                <div class="form-tabs">                    <button class="tab-button active" onclick="switchTab('buy')">شراء</button>                    <button class="tab-button" onclick="switchTab('sell')">بيع</button>                </div>                                <div class="order-types">                    <button class="order-type-btn active" onclick="changeOrderType('MARKET')">سوق</button>                    <button class="order-type-btn" onclick="changeOrderType('LIMIT')">محدود</button>                </div>                                <div id="orderMessages"></div>                                <div id="buyForm" class="trade-form">                    <div class="form-group" id="limitPriceGroup" style="display: none;">                        <label class="form-label">السعر (USDT)</label>                        <input type="number" class="form-input" id="buyPrice" step="0.01" placeholder="أدخل السعر">                    </div>                    <div class="form-group">                        <label class="form-label">الكمية</label>                        <input type="number" class="form-input" id="buyAmount" step="0.00001" placeholder="أدخل الكمية">                        <div class="percentage-buttons">                            <button class="percentage-btn" onclick="setPercentage('buy', 25)">25%</button>                            <button class="percentage-btn" onclick="setPercentage('buy', 50)">50%</button>                            <button class="percentage-btn" onclick="setPercentage('buy', 75)">75%</button>                            <button class="percentage-btn" onclick="setPercentage('buy', 100)">100%</button>                        </div>                    </div>                    <div class="form-group">                        <label class="form-label">الإجمالي (USDT)</label>                        <input type="number" class="form-input" id="buyTotal" readonly>                    </div>                    <button class="order-button buy-button" onclick="placeOrder('buy')" id="buyButton">                        شراء                    </button>                </div>                                <div id="sellForm" class="trade-form" style="display: none;">                    <div class="form-group" id="limitPriceGroupSell" style="display: none;">                        <label class="form-label">السعر (USDT)</label>                        <input type="number" class="form-input" id="sellPrice" step="0.01" placeholder="أدخل السعر">                    </div>                    <div class="form-group">                        <label class="form-label">الكمية</label>                        <input type="number" class="form-input" id="sellAmount" step="0.00001" placeholder="أدخل الكمية">                        <div class="percentage-buttons">                            <button class="percentage-btn" onclick="setPercentage('sell', 25)">25%</button>                            <button class="percentage-btn" onclick="setPercentage('sell', 50)">50%</button>                            <button class="percentage-btn" onclick="setPercentage('sell', 75)">75%</button>                            <button class="percentage-btn" onclick="setPercentage('sell', 100)">100%</button>                        </div>                    </div>                    <div class="form-group">                        <label class="form-label">الإجمالي (USDT)</label>                        <input type="number" class="form-input" id="sellTotal" readonly>                    </div>                    <button class="order-button sell-button" onclick="placeOrder('sell')" id="sellButton">                        بيع                    </button>                </div>            </div>        </div>                <div class="sidebar">            <div class="account-info">                <h3 class="section-title">معلومات الحساب</h3>                <div class="balance-item">                    <span class="currency">USDT</span>                    <span class="amount" id="usdtBalance">10,000.00</span>                </div>                <div class="balance-item">                    <span class="currency">BTC</span>                    <span class="amount" id="btcBalance">0.25</span>                </div>            </div>                        <div class="market-trades">                <h3 class="section-title">آخر التداولات</h3>                <div id="recentTrades" class="loading">جاري التحميل...</div>            </div>                        <div class="order-book">                <h3 class="section-title">دفتر الأوامر</h3>                <div class="order-book-header">                    <span>السعر</span>                    <span>الكمية</span>                    <span>الإجمالي</span>                </div>                <div id="orderBookContent" class="loading">جاري التحميل...</div>            </div>        </div>    </div>    <script>        // Global variables        let currentPair = 'BTCUSDT';        let currentInterval = '1m';        let currentOrderType = 'MARKET';        let currentTab = 'buy';        let wsConnection = null;        let priceWs = null;        let depthWs = null;        let tradesWs = null;        let reconnectInterval = null;        let lastPrice = null;        // API Configuration        const BINANCE_API_BASE = 'https://api.binance.com';        const BINANCE_WS_BASE = 'wss://stream.binance.com:9443';        // Initialize the application        document.addEventListener('DOMContentLoaded', function() {            console.log('🚀 بدء تشغيل تطبيق Binance Trading');            updateServerTime();            connectToAPI();            loadInitialData();            setupEventListeners();        });        // إكمال دالة updateServerTime        function updateServerTime() {            const now = new Date();            const timeString = now.toLocaleString('ar-SA', {                timeZone: 'UTC',                year: 'numeric',                month: '2-digit',                 day: '2-digit',                hour: '2-digit',                minute: '2-digit',                second: '2-digit'            });            document.getElementById('serverTime').textContent = `UTC: ${timeString}`;                        // تحديث كل ثانية            setTimeout(updateServerTime, 1000);        }        // دالة الاتصال بـ API        async function connectToAPI() {            try {                console.log('🔌 محاولة الاتصال بـ Binance API...');                                // تحديث حالة الاتصال                const statusDot = document.getElementById('statusDot');                const statusText = document.getElementById('statusText');                                statusDot.className = 'status-dot';                statusText.textContent = 'جاري الاتصال...';                                // اختبار الاتصال بـ API                const response = await fetch(`${BINANCE_API_BASE}/api/v3/ping`);                                if (response.ok) {                    statusDot.className = 'status-dot';                    statusText.textContent = 'متصل';                    console.log('✅ تم الاتصال بنجاح بـ Binance API');                                        // بدء اتصالات WebSocket                    initializeWebSockets();                } else {                    throw new Error('فشل في الاتصال بـ API');                }                            } catch (error) {                console.error('❌ خطأ في الاتصال:', error);                const statusDot = document.getElementById('statusDot');                const statusText = document.getElementById('statusText');                                statusDot.className = 'status-dot disconnected';                statusText.textContent = 'غير متصل';                                // إعادة المحاولة بعد 5 ثوان                setTimeout(connectToAPI, 5000);            }        }        // دالة تحميل البيانات الأولية        async function loadInitialData() {            try {                console.log('📊 تحميل البيانات الأولية...');                                // جلب إحصائيات 24 ساعة                await load24hStats();                                // جلب سعر الزوج الحالي                await loadCurrentPrice();                                // جلب دفتر الأوامر                await loadOrderBook();                                // جلب آخر التداولات                await loadRecentTrades();                                console.log('✅ تم تحميل البيانات الأولية بنجاح');                            } catch (error) {                console.error('❌ خطأ في تحميل البيانات:', error);                showError('فشل في تحميل البيانات الأولية');            }        }        // جلب إحصائيات 24 ساعة        async function load24hStats() {            try {                const response = await fetch(`${BINANCE_API_BASE}/api/v3/ticker/24hr?symbol=${currentPair}`);                const data = await response.json();                                if (response.ok) {                    document.getElementById('volume24h').textContent = formatNumber(data.volume);                    document.getElementById('high24h').textContent = `$${parseFloat(data.highPrice).toFixed(2)}`;                    document.getElementById('low24h').textContent = `$${parseFloat(data.lowPrice).toFixed(2)}`;                    document.getElementById('count24h').textContent = formatNumber(data.count);                    document.getElementById('avgPrice').textContent = `$${parseFloat(data.weightedAvgPrice).toFixed(2)}`;                    document.getElementById('prevClosePrice').textContent = `$${parseFloat(data.prevClosePrice).toFixed(2)}`;                } else {                    throw new Error(data.msg || 'فشل في جلب إحصائيات 24 ساعة');                }            } catch (error) {                console.error('خطأ في جلب إحصائيات 24 ساعة:', error);            }        }        // جلب السعر الحالي        async function loadCurrentPrice() {            try {                const response = await fetch(`${BINANCE_API_BASE}/api/v3/ticker/price?symbol=${currentPair}`);                const data = await response.json();                                if (response.ok) {                    const newPrice = parseFloat(data.price);                    updatePriceDisplay(newPrice);                } else {                    throw new Error(data.msg || 'فشل في جلب السعر الحالي');                }            } catch (error) {                console.error('خطأ في جلب السعر:', error);            }        }        // جلب دفتر الأوامر        async function loadOrderBook() {            try {                const response = await fetch(`${BINANCE_API_BASE}/api/v3/depth?symbol=${currentPair}&limit=20`);                const data = await response.json();                                if (response.ok) {                    updateOrderBook(data);                } else {                    throw new Error(data.msg || 'فشل في جلب دفتر الأوامر');                }            } catch (error) {                console.error('خطأ في جلب دفتر الأوامر:', error);                document.getElementById('orderBookContent').innerHTML = '<div class="error">فشل في تحميل دفتر الأوامر</div>';            }        }        // جلب آخر التداولات        async function loadRecentTrades() {            try {                const response = await fetch(`${BINANCE_API_BASE}/api/v3/trades?symbol=${currentPair}&limit=10`);                const data = await response.json();                                if (response.ok) {                    updateRecentTrades(data);                } else {                    throw new Error(data.msg || 'فشل في جلب التداولات الأخيرة');                }            } catch (error) {                console.error('خطأ في جلب التداولات:', error);                document.getElementById('recentTrades').innerHTML = '<div class="error">فشل في تحميل التداولات</div>';            }        }        // تحديث عرض السعر        function updatePriceDisplay(newPrice) {            const priceElement = document.getElementById('pairPrice');            const changeElement = document.getElementById('priceChange');                        // حساب التغيير في السعر            if (lastPrice !== null) {                const change = ((newPrice - lastPrice) / lastPrice * 100);                const changeText = change >= 0 ? `+${change.toFixed(2)}%` : `${change.toFixed(2)}%`;                                changeElement.textContent = changeText;                changeElement.className = change >= 0 ? 'price-change positive' : 'price-change negative';                                // تأثير فلاش للسعر                priceElement.classList.add('price-flash');                setTimeout(() => priceElement.classList.remove('price-flash'), 500);            }                        priceElement.textContent = `$${newPrice.toFixed(2)}`;            lastPrice = newPrice;        }        // تحديث دفتر الأوامر        function updateOrderBook(data) {            const container = document.getElementById('orderBookContent');                        let html = '<div class="order-book-asks">';                        // أوامر البيع (Asks) - مرتبة من الأقل للأعلى            const asks = data.asks.slice(0, 10).reverse();            asks.forEach(ask => {                const price = parseFloat(ask[0]);                const quantity = parseFloat(ask[1]);                const total = price * quantity;                                html += `                    <div class="order-book-item" onclick="setOrderPrice(${price})">                        <span>$${price.toFixed(2)}</span>                        <span>${quantity.toFixed(4)}</span>                        <span>$${total.toFixed(2)}</span>                    </div>                `;            });                        html += '</div><div style="height: 1px; background: #f0b90b; margin: 0.5rem 0;"></div><div class="order-book-bids">';                        // أوامر الشراء (Bids) - مرتبة من الأعلى للأقل            const bids = data.bids.slice(0, 10);            bids.forEach(bid => {                const price = parseFloat(bid[0]);                const quantity = parseFloat(bid[1]);                const total = price * quantity;                                html += `                    <div class="order-book-item" onclick="setOrderPrice(${price})">                        <span>$${price.toFixed(2)}</span>                        <span>${quantity.toFixed(4)}</span>                        <span>$${total.toFixed(2)}</span>                    </div>                `;            });                        html += '</div>';            container.innerHTML = html;        }        // تحديث التداولات الأخيرة        function updateRecentTrades(data) {            const container = document.getElementById('recentTrades');                        let html = '';            data.reverse().forEach(trade => {                const price = parseFloat(trade.price);                const qty = parseFloat(trade.qty);                const isBuyerMaker = trade.isBuyerMaker;                const tradeClass = isBuyerMaker ? 'trade-sell' : 'trade-buy';                const tradeType = isBuyerMaker ? 'بيع' : 'شراء';                                html += `                    <div class="trade-item">                        <span class="trade-price ${tradeClass}">$${price.toFixed(2)}</span>                        <span>${qty.toFixed(4)}</span>                        <span style="font-size: 0.8rem; color: #9ca3af;">${tradeType}</span>                    </div>                `;            });                        container.innerHTML = html;        }        // بدء اتصالات WebSocket        function initializeWebSockets() {            try {                console.log('🔄 بدء اتصالات WebSocket...');                                // إغلاق الاتصالات السابقة                closeWebSockets();                                // اتصال WebSocket للأسعار                const priceStream = `${currentPair.toLowerCase()}@ticker`;                priceWs = new WebSocket(`${BINANCE_WS_BASE}/ws/${priceStream}`);                                priceWs.onopen = () => {                    console.log('✅ اتصال أسعار WebSocket مفتوح');                };                                priceWs.onmessage = (event) => {                    const data = JSON.parse(event.data);                    updatePriceDisplay(parseFloat(data.c));                                        // تحديث إحصائيات 24 ساعة                    document.getElementById('volume24h').textContent = formatNumber(data.v);                    document.getElementById('high24h').textContent = `$${parseFloat(data.h).toFixed(2)}`;                    document.getElementById('low24h').textContent = `$${parseFloat(data.l).toFixed(2)}`;                    document.getElementById('count24h').textContent = formatNumber(data.n);                };                                // اتصال WebSocket لدفتر الأوامر                const depthStream = `${currentPair.toLowerCase()}@depth20@100ms`;                depthWs = new WebSocket(`${BINANCE_WS_BASE}/ws/${depthStream}`);                                depthWs.onopen = () => {                    console.log('✅ اتصال دفتر الأوامر WebSocket مفتوح');                };                                depthWs.onmessage = (event) => {                    const data = JSON.parse(event.data);                    updateOrderBook(data);                };                                // اتصال WebSocket للتداولات                const tradesStream = `${currentPair.toLowerCase()}@trade`;                tradesWs = new WebSocket(`${BINANCE_WS_BASE}/ws/${tradesStream}`);                                tradesWs.onopen = () => {                    console.log('✅ اتصال التداولات WebSocket مفتوح');                };                                tradesWs.onmessage = (event) => {                    const data = JSON.parse(event.data);                    addNewTrade(data);                };                                // معالجة أخطاء WebSocket                [priceWs, depthWs, tradesWs].forEach(ws => {                    ws.onerror = (error) => {                        console.error('❌ خطأ في WebSocket:', error);                    };                                        ws.onclose = () => {                        console.log('🔌 تم إغلاق اتصال WebSocket');                        // إعادة الاتصال بعد 3 ثوان                        setTimeout(initializeWebSockets, 3000);                    };                });                            } catch (error) {                console.error('❌ خطأ في بدء WebSocket:', error);            }        }        // إغلاق اتصالات WebSocket        function closeWebSockets() {            [priceWs, depthWs, tradesWs].forEach(ws => {                if (ws && ws.readyState === WebSocket.OPEN) {                    ws.close();                }            });        }        // إضافة تداول جديد        function addNewTrade(trade) {            const container = document.getElementById('recentTrades');            const price = parseFloat(trade.p);            const qty = parseFloat(trade.q);            const isBuyerMaker = trade.m;            const tradeClass = isBuyerMaker ? 'trade-sell' : 'trade-buy';            const tradeType = isBuyerMaker ? 'بيع' : 'شراء';                        const newTradeHtml = `                <div class="trade-item" style="animation: fadeIn 0.3s ease;">                    <span class="trade-price ${tradeClass}">$${price.toFixed(2)}</span>                    <span>${qty.toFixed(4)}</span>                    <span style="font-size: 0.8rem; color: #9ca3af;">${tradeType}</span>                </div>            `;                        // إضافة التداول في المقدمة            container.insertAdjacentHTML('afterbegin', newTradeHtml);                        // الاحتفاظ فقط بآخر 15 تداول            const trades = container.querySelectorAll('.trade-item');            if (trades.length > 15) {                trades[trades.length - 1].remove();            }        }        // إعداد مستمعي الأحداث        function setupEventListeners() {            // مستمعي تحديث الكمية والسعر            ['buyAmount', 'buyPrice', 'sellAmount', 'sellPrice'].forEach(id => {                const element = document.getElementById(id);                if (element) {                    element.addEventListener('input', calculateTotal);                }            });                        // مستمع إغلاق الصفحة            window.addEventListener('beforeunload', () => {                closeWebSockets();            });                        console.log('✅ تم إعداد مستمعي الأحداث');        }        // تغيير الزوج المالي        function changePair(newPair) {            if (newPair === currentPair) return;                        console.log(`🔄 تغيير الزوج من ${currentPair} إلى ${newPair}`);                        // تحديث الزر النشط            document.querySelectorAll('.pair-button').forEach(btn => {                btn.classList.remove('active');            });            event.target.classList.add('active');                        // إغلاق الاتصالات السابقة            closeWebSockets();                        // تحديث الزوج الحالي            currentPair = newPair;            document.getElementById('pairName').textContent = newPair.replace('USDT', '/USDT');                        // إعادة تحميل البيانات            loadInitialData();                        // إعادة بدء WebSocket            setTimeout(initializeWebSockets, 1000);        }        // تغيير الفترة الزمنية        function changeInterval(newInterval) {            if (newInterval === currentInterval) return;                        // تحديث الزر النشط            document.querySelectorAll('.interval-button').forEach(btn => {                btn.classList.remove('active');            });            event.target.classList.add('active');                        currentInterval = newInterval;            console.log(`📊 تغيير الفترة الزمنية إلى ${newInterval}`);                        // هنا يمكن إضافة تحديث الرسم البياني            updateChart();        }        // تحديث الرسم البياني (مبسط)        function updateChart() {            const chartCanvas = document.getElementById('chartCanvas');            chartCanvas.innerHTML = `                <div style="display: flex; align-items: center; justify-content: center; height: 100%; color: #9ca3af;">                    📈 الرسم البياني لـ ${currentPair} - فترة ${currentInterval}                    <br><small>يتطلب مكتبة الرسوم البيانية (Chart.js أو TradingView)</small>                </div>            `;        }        // تبديل التبويبات        function switchTab(tab) {            currentTab = tab;                        // تحديث الأزرار            document.querySelectorAll('.tab-button').forEach(btn => {                btn.classList.remove('active');            });            event.target.classList.add('active');                        // إظهار/إخفاء النماذج            document.getElementById('buyForm').style.display = tab === 'buy' ? 'block' : 'none';            document.getElementById('sellForm').style.display = tab === 'sell' ? 'block' : 'none';        }        // تغيير نوع الأمر        function changeOrderType(type) {            currentOrderType = type;                        // تحديث الأزرار            document.querySelectorAll('.order-type-btn').forEach(btn => {                btn.classList.remove('active');            });            event.target.classList.add('active');                        // إظهار/إخفاء حقل السعر            const limitGroups = ['limitPriceGroup', 'limitPriceGroupSell'];            limitGroups.forEach(groupId => {                const group = document.getElementById(groupId);                if (group) {                    group.style.display = type === 'LIMIT' ? 'block' : 'none';                }            });        }        // تعيين نسبة مئوية من الرصيد        function setPercentage(side, percentage) {            if (side === 'buy') {                const usdtBalance = parseFloat(document.getElementById('usdtBalance').textContent.replace(',', ''));                const availableUsdt = usdtBalance * (percentage / 100);                                if (currentOrderType === 'MARKET' && lastPrice) {                    const amount = availableUsdt / lastPrice;                    document.getElementById('buyAmount').value = amount.toFixed(6);                } else if (currentOrderType === 'LIMIT') {                    const price = parseFloat(document.getElementById('buyPrice').value) || lastPrice;                    if (price) {                        const amount = availableUsdt / price;                        document.getElementById('buyAmount').value = amount.toFixed(6);                    }                }            } else if (side === 'sell') {                const btcBalance = parseFloat(document.getElementById('btcBalance').textContent);                const amount = btcBalance * (percentage / 100);                document.getElementById('sellAmount').value = amount.toFixed(6);            }                        calculateTotal();        }        // حساب الإجمالي        function calculateTotal() {            // حساب إجمالي الشراء            const buyAmount = parseFloat(document.getElementById('buyAmount').value) || 0;            const buyPrice = currentOrderType === 'LIMIT' ?                 (parseFloat(document.getElementById('buyPrice').value) || 0) :                 (lastPrice || 0);            document.getElementById('buyTotal').value = (buyAmount * buyPrice).toFixed(2);                        // حساب إجمالي البيع            const sellAmount = parseFloat(document.getElementById('sellAmount').value) || 0;            const sellPrice = currentOrderType === 'LIMIT' ?                 (parseFloat(document.getElementById('sellPrice').value) || 0) :                 (lastPrice || 0);            document.getElementById('sellTotal').value = (sellAmount * sellPrice).toFixed(2);        }        // تعيين سعر من دفتر الأوامر        function setOrderPrice(price) {            if (currentTab === 'buy') {                document.getElementById('buyPrice').value = price.toFixed(2);            } else {                document.getElementById('sellPrice').value = price.toFixed(2);            }            calculateTotal();        }        // وضع أمر (تجريبي)        function placeOrder(side) {            try {                const amount = parseFloat(document.getElementById(`${side}Amount`).value);                const price = currentOrderType === 'LIMIT' ?                     parseFloat(document.getElementById(`${side}Price`).value) :                     lastPrice;                                if (!amount || amount <= 0) {                    showError('يرجى إدخال كمية صحيحة');                    return;                }                                if (currentOrderType === 'LIMIT' && (!price || price <= 0)) {                    showError('يرجى إدخال سعر صحيح');                    return;                }                                // محاكاة وضع الأمر (في التطبيق الحقيقي، يتم إرسال إلى API)                const orderData = {                    symbol: currentPair,                    side: side.toUpperCase(),                    type: currentOrderType,                    quantity: amount,                    price: price,                    timestamp: Date.now()                };                                console.log('📝 أمر جديد:', orderData);                                // محاكاة تحديث الرصيد                simulateBalanceUpdate(side, amount, price);                                showSuccess(`تم وضع أمر ${side === 'buy' ? 'الشراء' : 'البيع'} بنجاح!`);                                // مسح النموذج                document.getElementById(`${side}Amount`).value = '';                if (currentOrderType === 'LIMIT') {                    document.getElementById(`${side}Price`).value = '';                }                document.getElementById(`${side}Total`).value = '';                            } catch (error) {                console.error('❌ خطأ في وضع الأمر:', error);                showError('فشل في وضع الأمر');            }        }        // محاكاة تحديث الرصيد        function simulateBalanceUpdate(side, amount, price) {            const usdtElement = document.getElementById('usdtBalance');            const btcElement = document.getElementById('btcBalance');                        let usdtBalance = parseFloat(usdtElement.textContent.replace(',', ''));            let btcBalance = parseFloat(btcElement.textContent);                        if (side === 'buy') {                const totalCost = amount * price;                usdtBalance -= totalCost;                btcBalance += amount;            } else {                const totalReceived = amount * price;                usdtBalance += totalReceived;                btcBalance -= amount;            }                        usdtElement.textContent = formatNumber(usdtBalance);            btcElement.textContent = btcBalance.toFixed(6);        }        // عرض رسالة خطأ        function showError(message) {            const container = document.getElementById('orderMessages');            container.innerHTML = `<div class="error">❌ ${message}</div>`;            setTimeout(() => {                container.innerHTML = '';            }, 5000);        }        // عرض رسالة نجاح        function showSuccess(message) {            const container = document.getElementById('orderMessages');            container.innerHTML = `<div class="success">✅ ${message}</div>`;            setTimeout(() => {                container.innerHTML = '';            }, 3000);        }        // تنسيق الأرقام        function formatNumber(num) {            const number = parseFloat(num);            if (number >= 1000000000) {                return (number / 1000000000).toFixed(2) + 'B';            } else if (number >= 1000000) {                return (number / 1000000).toFixed(2) + 'M';            } else if (number >= 1000) {                return (number / 1000).toFixed(2) + 'K';            } else {                return number.toFixed(2);            }        }        // إضافة CSS للرسوم المتحركة        const style = document.createElement('style');        style.textContent = `            @keyframes fadeIn {                from { opacity: 0; transform: translateY(-10px); }                to { opacity: 1; transform: translateY(0); }            }                        .fade-in {                animation: fadeIn 0.3s ease;            }        `;        document.head.appendChild(style);        // دالة لتحديث حالة الاتصال بشكل دوري        function checkConnectionStatus() {            // فحص حالة جميع اتصالات WebSocket            const connections = [priceWs, depthWs, tradesWs];            const activeConnections = connections.filter(ws => ws && ws.readyState === WebSocket.OPEN).length;                        const statusDot = document.getElementById('statusDot');            const statusText = document.getElementById('statusText');                        if (activeConnections === connections.length) {                statusDot.className = 'status-dot';                statusText.textContent = `متصل (${activeConnections}/3)`;            } else if (activeConnections > 0) {                statusDot.className = 'status-dot';                statusText.textContent = `متصل جزئياً (${activeConnections}/3)`;            } else {                statusDot.className = 'status-dot disconnected';                statusText.textContent = 'غير متصل';            }        }        // فحص الاتصال كل 5 ثوان        setInterval(checkConnectionStatus, 5000);        console.log('🎉 تم تحميل جميع دوال JavaScript بنجاح');    </script></body></html>